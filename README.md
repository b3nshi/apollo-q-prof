# Query profiler for Apollo Server 2
![](https://img.shields.io/static/v1.svg?label=Latest&message=2.1.0&color=green)

##### Dependencies
![](https://img.shields.io/static/v1.svg?label=Apollo%20Server&message=2.2.3&color=red)
![](https://img.shields.io/static/v1.svg?label=Typescript&message=3.3.3&color=blue)
![](https://img.shields.io/static/v1.svg?label=GraphQL&message=14.0.2&color=yellow)

[Apollo Server](https://www.apollographql.com) is a community-maintained open-source GraphQL server. This Query Profiler project try to make super easy to control how many and which requests are called when a query is executed.

## Getting started

1. `npm i -D apollo-q-prof`
2. Replace `app = new ApolloServer({configData})` by `app = ApolloQProf({configData})`
3. Run your application and that's all!

## Configuration (Experimental)

There is a second [optional] argument to provide a configuration.
The current version only accept an `ApolloServer` object. So if you are using `apollo-server-express` you can provide you object and version and use it.

```
{
  ApolloInstance: ApolloServer
}
```

## Running the UI
Apollo-Q-Prof provide an UI to be able to see the generated `json` file with the information about the request/responses. To be able to use it you need to do the following:

1. In your project, open you `package.json` and update the `scripts` section with a new command like:
```
{
  ...,
  scripts: {
    ...,
    "ui-prof": "apollo-q-prof-ui"
  }
}
```
2. Ejecute the command: `npm run ui-prof`
3. Open a browser and go to the url: `http://localhost:9000` (or a different port - check the console)
4. Now you can open the file `apollo-q-prof.json` located in the root folder of your project (the one generated by the profiler).
5. Refresh it when you want to see new data.

## Structure of JSON file

```
[
  {
    "outgoingRequests": [
      {
        "args": "[ 'parameter1',... ,'paramenterN' ]",
        "execution-time": "time in ms",
        "method": "",
        "dataSource": ""
      },
      ...
    ],
    "request": {
      "operationName": "",
      "variables": {},
      "query": "{...}"
    },
    "response": {
      "execution-time": "time in ms"
    }
  },
]
```

## Upcoming versions

There are some improvements that we are going to include in upcoming versions like:
* Timeline for each request
* Real-time monitoring
* Statitics and Graphs
